<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MAY-Connect | Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<div id="pinModal" class="modal hidden">
<div class="modal-content">

<h3>Enter Transaction PIN</h3>

<div class="pin-inputs">
<input maxlength="1" type="password">
<input maxlength="1" type="password">
<input maxlength="1" type="password">
<input maxlength="1" type="password">
</div>

<button onclick="submitPin()" class="primary-btn">Verify</button>

</div>
</div>


<!-- SPLASH LOADER -->
<div id="splashLoader" class="splash-loader hidden">
  <div id="loaderState" class="splash-content">
    <div class="splash-ring"></div>
    <img src="images/logo.png" alt="MAY-Connect">
  </div>
</div>

<!-- NETWORK STATUS -->
<div id="networkStatus" class="network-status hidden"></div>

<!-- LOGO + GREETING -->
<div class="logo-circle">
  <img src="images/logo.png" alt="MAY-Connect Logo">
</div>

<div style="text-align:center; margin-bottom:1rem;">
  <h3 id="greeting">Hello, User üëã</h3>
</div>

<audio id="welcomeSound" src="sounds/welcome.mp3" preload="auto"></audio>
<audio id="successSound" src="sounds/success.mp3" preload="auto"></audio>

<!-- MORE PANEL -->
<div id="morePanel" class="more-panel hidden">
  <button onclick="openSetPinFromMore()">Set Transaction PIN</button>
  <button onclick="enableBiometric()">Enable Biometric</button>
  <button onclick="forgotPin()">Forgot PIN</button>
  <button onclick="forgotPassword()">Forgot Password</button>
  <button onclick="contactWhatsApp()">WhatsApp Support</button>
  <button onclick="callSupport()">Call Support</button>
  <button onclick="copyAccount()">Copy Account</button>
  <button onclick="logout()">Logout</button>
  <button onclick="closeMore()">Close</button>
</div>

<!-- DASHBOARD CONTENT -->
<div class="dashboard-content">

  <!-- WALLET -->
  <div class="wallet-card">
    <p>Wallet Balance</p>
    <strong id="walletBalance">‚Ç¶0</strong>
    <button onclick="copyAccount()">Copy Account Number</button>
  </div>

  <!-- QUICK ACTIONS -->
  <div class="quick-actions">
    <button onclick="location.href='data.html'">üì∂ Buy Data</button>
    <button onclick="location.href='airtime.html'">üìû Buy Airtime</button>
  </div>

  <!-- DATA PLANS -->
  <div id="plansGrid" class="plans-grid"></div>

  <!-- CONFIRM ORDER -->
  <button id="confirmOrderBtn" class="primary-btn hidden" onclick="confirmOrder()">Confirm</button>

  <!-- TRANSACTIONS LIST -->
  <div id="transactionsList" class="transactions-list"></div>
</div>

<!-- PIN MODAL -->
<div id="pinModal" class="modal hidden">
  <div class="modal-content">
    <h3>Enter PIN</h3>
    <div class="pin-inputs">
      <input type="password" maxlength="1">
      <input type="password" maxlength="1">
      <input type="password" maxlength="1">
      <input type="password" maxlength="1">
    </div>
    <button id="pinActionBtn" class="primary-btn" onclick="submitPin()">Pay</button>
    <button onclick="closePinModal()" class="secondary-btn">Cancel</button>
  </div>
</div>

<!-- RECEIPT MODAL -->
<div id="receiptModal" class="modal hidden">
  <div class="modal-content">
    <h3>Receipt</h3>
    <div id="receiptBody"></div>
    <button onclick="receiptModal.classList.add('hidden')" class="primary-btn">Close</button>
  </div>
</div>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
  <button onclick="location.href='dashboard.html'">üè†<br>Home</button>
  <button onclick="location.href='transactions.html'">üí≥<br>Transactions</button>
  <button onclick="toggleMore()">‚öôÔ∏è<br>More</button>
</div>

<script src="app.js"></script>

<script>
/* ================= MORE PANEL ================= */
function toggleMore() { morePanel.classList.toggle("hidden"); }
function closeMore() { morePanel.classList.add("hidden"); }

/* ================= MORE PANEL ACTIONS ================= */
function enableBiometric(){ alert("Biometric coming soon"); }
function forgotPin(){ alert("Forgot PIN"); }
function forgotPassword(){ alert("Forgot Password"); }
function contactWhatsApp(){ window.open("https://wa.me/2348117988561"); }
function callSupport(){ location.href="tel:+2348117988561"; }
function logout(){ localStorage.clear(); location.href="login.html"; }
function copyAccount(){
  const acc="1234567890";
  navigator.clipboard.writeText(acc);
  alert("Copied: "+acc);
}


/* ================= PIN UX ================= */
const pinInputs = document.querySelectorAll(".pin-inputs input");
<script>
let pinMode = "set";

function $(id){
  return document.getElementById(id);
}

/* ===== PIN MODAL CONTROL ===== */

function openSetPinFromMore(){
  pinMode = "set";
  $("pinTitle").textContent = "Set Transaction PIN";
  $("pinActionBtn").textContent = "Verify";
  $("pinModal").classList.remove("hidden");
}

function openPinModal(mode){
  pinMode = mode;
  $("pinTitle").textContent = mode === "set" ? "Set Transaction PIN" : "Enter PIN";
  $("pinActionBtn").textContent = "Verify";
  $("pinModal").classList.remove("hidden");
}

function closePinModal(){
  $("pinModal").classList.add("hidden");
}

/* ===== PIN INPUT UX ===== */

const pinInputs = document.querySelectorAll(".pin-inputs input");

pinInputs.forEach((input, idx) => {
  input.addEventListener("input", e => {
    if (e.target.value.length === 1 && idx < pinInputs.length - 1) {
      pinInputs[idx + 1].focus();
    }
  });

  input.addEventListener("keydown", e => {
    if (e.key === "Backspace" && !input.value && idx > 0) {
      pinInputs[idx - 1].focus();
    }
  });
});

/* SHOW / HIDE PIN */

function togglePinVisibility() {
  pinInputs.forEach(i => {
    i.type = i.type === "password" ? "text" : "password";
  });
}
</script>
// Auto-focus next & backspace
pinInputs.forEach((input, idx) => {
  input.addEventListener("input", e => {
    if (e.target.value.length===1 && idx<pinInputs.length-1) pinInputs[idx+1].focus();
  });
  input.addEventListener("keydown", e => {
    if(e.key==="Backspace" && !input.value && idx>0) pinInputs[idx-1].focus();
  });
});

// Show/Hide toggle
function togglePinVisibility() {
  pinInputs.forEach(i => i.type=i.type==="password"?"text":"password");
}

const pinToggleBtn = document.createElement("button");
pinToggleBtn.type="button";
pinToggleBtn.textContent="Show";
pinToggleBtn.className="show-password-btn";
pinToggleBtn.style.marginTop="0.5rem";
pinToggleBtn.onclick=()=>{
  togglePinVisibility();
  pinToggleBtn.textContent = pinInputs[0].type==="password"?"Show":"Hide";
};
document.querySelector("#pinModal .modal-content").appendChild(pinToggleBtn);

// Clear inputs
function clearPinInputs(){ pinInputs.forEach(i=>i.value=""); }

/* ================= INIT ================= */
document.addEventListener("DOMContentLoaded", async ()=>{
  welcomeSound.play();

  const name = localStorage.getItem("name") || "User";
  greeting.textContent=`Hello, ${name} üëã`;

  const token = localStorage.getItem("token");
  if(!token) return;

  /* Fetch wallet */
  try {
    const res = await fetch(`${backendUrl}/api/wallet`, {
      headers:{Authorization:`Bearer ${token}`}
    });
    const data = await res.json();
    walletBalance.textContent=`‚Ç¶${data.balance||0}`;
  } catch {}

  /* Render plans */
  renderPlans();
  checkPinStatus();
});
</script>

</body>
</html>
